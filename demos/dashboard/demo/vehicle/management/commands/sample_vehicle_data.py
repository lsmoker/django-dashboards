import datetime

from django.core.management.base import BaseCommand

from model_bakery import baker

from ...models import Data, Parameter


class Command(BaseCommand):
    def handle(self, *args, **options):
        if Data.objects.count() == 0:
            vehicles = baker.make("Vehicle", _quantity=5, _bulk_create=True)  # type: ignore
            location_param, _ = Parameter.objects.get_or_create(
                name="Current Location", cast_type=Parameter.CastType.COORDINATE
            )
            points = [
                [-5.9080590225154594, 54.61125585423915],
                [-5.907220686294465, 54.61348045202118],
                [-5.9047159184233635, 54.61563394867426],
                [-5.901590024826248, 54.61814857726122],
                [-5.898159427006902, 54.61991052092111],
                [-5.894878617213379, 54.62193504293472],
                [-5.8918910706244105, 54.62441071676935],
                [-5.888554370173239, 54.62671435721114],
                [-5.884587480099299, 54.62938240463254],
                [-5.881506714602239, 54.63223352416307],
                [-5.878215072426741, 54.63520752326079],
                [-5.8744047112483315, 54.637840033208846],
                [-5.868002410590151, 54.639066068527285],
                [-5.863885314457974, 54.63911722972256],
                [-5.858235513544798, 54.63866171225709],
                [-5.8544052079139135, 54.64083991681724],
                [-5.849578763845329, 54.64371920929972],
                [-5.844387204946855, 54.645043337241674],
                [-5.840317824922778, 54.64819040504361],
                [-5.8348386973752895, 54.650262166448925],
                [-5.8304655521862685, 54.653224109425224],
                [-5.8264740108880915, 54.65454799444336],
                [-5.821969207925008, 54.65659422497362],
                [-5.822640195636382, 54.66205862096916],
                [-5.835438380420413, 54.66728102712938],
                [-5.843454789661337, 54.666726999215655],
                [-5.855674999967022, 54.67099354227426],
                [-5.8655682745470585, 54.673046187487785],
                [-5.874118880472366, 54.67354680338988],
                [-5.88112080745023, 54.67333893494575],
                [-5.887189961073489, 54.67230591762953],
                [-5.88822942642966, 54.66861587793662],
                [-5.890054876451558, 54.6645336050299],
                [-5.8932773551217394, 54.661128439704356],
                [-5.8949295412090805, 54.657740196091424],
                [-5.8950760407146845, 54.655591193246806],
                [-5.900278753889381, 54.653847558362116],
                [-5.90394488896186, 54.6514067463182],
                [-5.907179670027972, 54.64853476197976],
                [-5.911823863242631, 54.647242922149246],
            ]
            for vehicle in vehicles:
                data = []
                date = datetime.datetime.now()

                for i, p in enumerate(points):
                    data.append(
                        Data(
                            vehicle=vehicle,
                            value=str(p),
                            parameter=location_param,
                            timestamp=date + datetime.timedelta(minutes=i),
                        )
                    )

                Data.objects.bulk_create(data)
